{% extends "base.html" %}

{% block title %}Dashboard - Equity Research Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Market Overview Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card dashboard-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-globe"></i> Market Overview
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Major Indices -->
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <div class="index-card" id="sp500-index">
                                        <div class="index-name">S&P 500</div>
                                        <div class="index-value">Loading...</div>
                                        <div class="index-change">--</div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="index-card" id="nasdaq-index">
                                        <div class="index-name">NASDAQ</div>
                                        <div class="index-value">Loading...</div>
                                        <div class="index-change">--</div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="index-card" id="dow-index">
                                        <div class="index-name">Dow Jones</div>
                                        <div class="index-value">Loading...</div>
                                        <div class="index-change">--</div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="index-card" id="vix-index">
                                        <div class="index-name">VIX</div>
                                        <div class="index-value">Loading...</div>
                                        <div class="index-change">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sector Performance -->
                        <div class="col-md-4">
                            <h6>Sector Performance</h6>
                            <div id="sector-performance" class="sector-list">
                                <div class="text-muted">Loading sectors...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Analysis Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-graph-up"></i> Stock Analysis
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary active" data-period="1d">1D</button>
                        <button type="button" class="btn btn-sm btn-outline-primary" data-period="5d">5D</button>
                        <button type="button" class="btn btn-sm btn-outline-primary" data-period="1mo">1M</button>
                        <button type="button" class="btn btn-sm btn-outline-primary" data-period="3mo">3M</button>
                        <button type="button" class="btn btn-sm btn-outline-primary" data-period="1y">1Y</button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Stock Price Display -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="stock-price-display">
                                <div class="stock-symbol" id="stock-symbol">--</div>
                                <div class="stock-name" id="stock-name">Select a stock to analyze</div>
                                <div class="stock-price" id="current-price">--</div>
                                <div class="stock-change">
                                    <span id="price-change">--</span>
                                    <span id="price-change-percent">(--)</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="key-metrics">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="metric-item">
                                            <span class="metric-label">Market Cap</span>
                                            <span class="metric-value" id="market-cap-metric">--</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-item">
                                            <span class="metric-label">P/E Ratio</span>
                                            <span class="metric-value" id="pe-metric">--</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-item">
                                            <span class="metric-label">Volume</span>
                                            <span class="metric-value" id="volume-metric">--</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-item">
                                            <span class="metric-label">52W High</span>
                                            <span class="metric-value" id="high52w-metric">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="row">
                        <div class="col-md-8">
                            <div class="chart-container">
                                <div id="price-chart" class="chart"></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="chart-container">
                                <div id="volume-chart" class="chart"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Metrics Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card dashboard-card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-calculator"></i> Financial Metrics
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">ROE</div>
                                <div class="metric-value" id="roe-metric">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">ROA</div>
                                <div class="metric-value" id="roa-metric">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">Debt/Equity</div>
                                <div class="metric-value" id="debt-equity-metric">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">Current Ratio</div>
                                <div class="metric-value" id="current-ratio-metric">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card dashboard-card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-shield-check"></i> Risk Metrics
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">Beta</div>
                                <div class="metric-value" id="beta-metric">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">Sharpe Ratio</div>
                                <div class="metric-value" id="sharpe-metric">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">Volatility</div>
                                <div class="metric-value" id="volatility-metric">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card">
                                <div class="metric-title">VaR (95%)</div>
                                <div class="metric-value" id="var-metric">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- News and Analyst Recommendations -->
    <div class="row">
        <div class="col-md-8">
            <div class="card dashboard-card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-newspaper"></i> Latest News
                    </h6>
                </div>
                <div class="card-body">
                    <div id="news-container" class="news-container">
                        <div class="text-muted">Select a stock to view related news...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card dashboard-card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-people"></i> Analyst Recommendations
                    </h6>
                </div>
                <div class="card-body">
                    <div id="recommendations-container" class="recommendations-container">
                        <div class="text-muted">Select a stock to view analyst recommendations...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize dashboard-specific functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Set up period buttons
        const periodButtons = document.querySelectorAll('[data-period]');
        periodButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                periodButtons.forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                // Update charts with new period
                const period = this.getAttribute('data-period');
                if (currentSymbol) {
                    updateChartsWithPeriod(currentSymbol, period);
                }
            });
        });
    });
    
    // Function to update charts with specific period
    async function updateChartsWithPeriod(symbol, period) {
        try {
            const response = await fetch(`/api/stock/${symbol}/charts?period=${period}`);
            if (response.ok) {
                const chartData = await response.json();
                updateCharts(chartData);
            }
        } catch (error) {
            console.error('Error updating charts:', error);
        }
    }
</script>
{% endblock %}
