<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Equity Research Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .register-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .register-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 500px;
            width: 100%;
        }
        
        .register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .register-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .register-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .register-body {
            padding: 40px 30px;
        }
        
        .form-floating {
            margin-bottom: 20px;
        }
        
        .form-floating .form-control {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-floating .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .form-floating .form-control.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        .form-floating .form-control.is-valid {
            border-color: #198754;
            box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
        }
        
        .form-floating label {
            padding: 15px 20px;
            color: #6c757d;
        }
        
        .btn-register {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-register:disabled {
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }
        
        .alert {
            border-radius: 12px;
            border: none;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #74c0fc 0%, #4dabf7 100%);
            color: white;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #ffd43b 0%, #fcc419 100%);
            color: #212529;
        }
        
        .divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e9ecef;
        }
        
        .divider span {
            background: white;
            padding: 0 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .login-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .login-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        .login-link a:hover {
            color: #764ba2;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            z-index: 10;
        }
        
        .password-toggle:hover {
            color: #495057;
        }
        
        .form-check {
            margin-bottom: 20px;
        }
        
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        .password-strength {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }
        
        .password-strength.weak {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .password-strength.medium {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .password-strength.strong {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .strength-bar {
            height: 4px;
            background-color: #e9ecef;
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .strength-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        
        .strength-fill.weak {
            background-color: #dc3545;
            width: 33%;
        }
        
        .strength-fill.medium {
            background-color: #ffc107;
            width: 66%;
        }
        
        .strength-fill.strong {
            background-color: #198754;
            width: 100%;
        }
        
        .requirements-list {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .requirement {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
        }
        
        .requirement.met {
            color: #198754;
        }
        
        .requirement.unmet {
            color: #6c757d;
        }
        
        .requirement i {
            margin-right: 5px;
            font-size: 0.8rem;
        }
        
        .loading-spinner {
            display: none;
            margin-right: 10px;
        }
        
        .btn-register:disabled .loading-spinner {
            display: inline-block;
        }
        
        .error-icon {
            color: #dc3545;
            margin-right: 8px;
        }
        
        .success-icon {
            color: #198754;
            margin-right: 8px;
        }
        
        .warning-icon {
            color: #ffc107;
            margin-right: 8px;
        }
        
        .info-icon {
            color: #0dcaf0;
            margin-right: 8px;
        }
        
        .terms-checkbox {
            margin-bottom: 20px;
        }
        
        .terms-checkbox .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        .terms-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .terms-link:hover {
            color: #764ba2;
            text-decoration: underline;
        }
        
        @media (max-width: 576px) {
            .register-card {
                margin: 20px;
                border-radius: 15px;
            }
            
            .register-header {
                padding: 30px 20px;
            }
            
            .register-header h1 {
                font-size: 1.8rem;
            }
            
            .register-body {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-card">
            <div class="register-header">
                <h1><i class="fas fa-user-plus me-3"></i>Register</h1>
                <p>Create your Equity Research Dashboard account</p>
            </div>
            
            <div class="register-body">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
                                {% if category == 'error' %}
                                    <i class="fas fa-exclamation-triangle error-icon"></i>
                                {% elif category == 'success' %}
                                    <i class="fas fa-check-circle success-icon"></i>
                                {% elif category == 'warning' %}
                                    <i class="fas fa-exclamation-circle warning-icon"></i>
                                {% else %}
                                    <i class="fas fa-info-circle info-icon"></i>
                                {% endif %}
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- Registration Form -->
                <form id="registerForm" method="POST" novalidate>
                    <div class="form-floating">
                        <input type="text" 
                               class="form-control" 
                               id="username" 
                               name="username" 
                               placeholder="Username"
                               required
                               minlength="3"
                               maxlength="30"
                               pattern="[a-zA-Z0-9_-]+"
                               autocomplete="username">
                        <label for="username">
                            <i class="fas fa-user me-2"></i>Username
                        </label>
                        <div class="invalid-feedback" id="username-error">
                            Username must be 3-30 characters and contain only letters, numbers, hyphens, and underscores.
                        </div>
                        <div class="requirements-list">
                            <div class="requirement" id="username-length">
                                <i class="fas fa-circle"></i>3-30 characters
                            </div>
                            <div class="requirement" id="username-format">
                                <i class="fas fa-circle"></i>Letters, numbers, hyphens, underscores only
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-floating">
                        <input type="email" 
                               class="form-control" 
                               id="email" 
                               name="email" 
                               placeholder="Email"
                               required
                               autocomplete="email">
                        <label for="email">
                            <i class="fas fa-envelope me-2"></i>Email Address
                        </label>
                        <div class="invalid-feedback" id="email-error">
                            Please enter a valid email address.
                        </div>
                    </div>
                    
                    <div class="form-floating">
                        <input type="password" 
                               class="form-control" 
                               id="password" 
                               name="password" 
                               placeholder="Password"
                               required
                               minlength="8"
                               autocomplete="new-password">
                        <label for="password">
                            <i class="fas fa-lock me-2"></i>Password
                        </label>
                        <button type="button" class="password-toggle" onclick="togglePassword('password')">
                            <i class="fas fa-eye" id="password-icon"></i>
                        </button>
                        <div class="invalid-feedback" id="password-error">
                            Password must be at least 8 characters long.
                        </div>
                        <div class="password-strength" id="password-strength">
                            <div class="d-flex justify-content-between">
                                <span id="strength-text">Password Strength</span>
                                <span id="strength-percentage"></span>
                            </div>
                            <div class="strength-bar">
                                <div class="strength-fill" id="strength-fill"></div>
                            </div>
                        </div>
                        <div class="requirements-list">
                            <div class="requirement" id="password-length">
                                <i class="fas fa-circle"></i>At least 8 characters
                            </div>
                            <div class="requirement" id="password-uppercase">
                                <i class="fas fa-circle"></i>One uppercase letter
                            </div>
                            <div class="requirement" id="password-lowercase">
                                <i class="fas fa-circle"></i>One lowercase letter
                            </div>
                            <div class="requirement" id="password-number">
                                <i class="fas fa-circle"></i>One number
                            </div>
                            <div class="requirement" id="password-special">
                                <i class="fas fa-circle"></i>One special character
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-floating">
                        <input type="password" 
                               class="form-control" 
                               id="confirm-password" 
                               name="confirm_password" 
                               placeholder="Confirm Password"
                               required
                               autocomplete="new-password">
                        <label for="confirm-password">
                            <i class="fas fa-lock me-2"></i>Confirm Password
                        </label>
                        <button type="button" class="password-toggle" onclick="togglePassword('confirm-password')">
                            <i class="fas fa-eye" id="confirm-password-icon"></i>
                        </button>
                        <div class="invalid-feedback" id="confirm-password-error">
                            Passwords do not match.
                        </div>
                    </div>
                    
                    <div class="terms-checkbox">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="terms-accept" name="terms_accept" required>
                            <label class="form-check-label" for="terms-accept">
                                I agree to the <a href="#" class="terms-link" onclick="showTerms()">Terms of Service</a> and 
                                <a href="#" class="terms-link" onclick="showPrivacy()">Privacy Policy</a>
                            </label>
                            <div class="invalid-feedback" id="terms-error">
                                You must accept the terms and conditions to continue.
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="newsletter" name="newsletter">
                        <label class="form-check-label" for="newsletter">
                            Subscribe to our newsletter for updates and insights
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-success btn-register" id="register-btn">
                        <span class="loading-spinner spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        <i class="fas fa-user-plus me-2"></i>Create Account
                    </button>
                </form>
                
                <div class="divider">
                    <span>Already have an account?</span>
                </div>
                
                <div class="login-link">
                    <a href="/auth/login">
                        <i class="fas fa-sign-in-alt me-2"></i>Sign in to your account
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Terms of Service Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">
                        <i class="fas fa-file-contract me-2"></i>Terms of Service
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Acceptance of Terms</h6>
                    <p>By accessing and using the Equity Research Dashboard, you accept and agree to be bound by the terms and provision of this agreement.</p>
                    
                    <h6>2. Use License</h6>
                    <p>Permission is granted to temporarily download one copy of the materials (information or software) on the Equity Research Dashboard for personal, non-commercial transitory viewing only.</p>
                    
                    <h6>3. Disclaimer</h6>
                    <p>The materials on the Equity Research Dashboard are provided on an 'as is' basis. The platform makes no warranties, expressed or implied, and hereby disclaims and negates all other warranties including without limitation, implied warranties or conditions of merchantability, fitness for a particular purpose, or non-infringement of intellectual property or other violation of rights.</p>
                    
                    <h6>4. Limitations</h6>
                    <p>In no event shall the Equity Research Dashboard or its suppliers be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on the platform.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">
                        <i class="fas fa-shield-alt me-2"></i>Privacy Policy
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Information We Collect</h6>
                    <p>We collect information you provide directly to us, such as when you create an account, use our services, or contact us for support.</p>
                    
                    <h6>2. How We Use Your Information</h6>
                    <p>We use the information we collect to provide, maintain, and improve our services, to communicate with you, and to develop new features.</p>
                    
                    <h6>3. Information Sharing</h6>
                    <p>We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy.</p>
                    
                    <h6>4. Data Security</h6>
                    <p>We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.</p>
                    
                    <h6>5. Your Rights</h6>
                    <p>You have the right to access, update, or delete your personal information. You can also opt out of certain communications and data collection.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Form validation and submission
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registerForm');
            const usernameInput = document.getElementById('username');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const termsCheckbox = document.getElementById('terms-accept');
            const registerBtn = document.getElementById('register-btn');
            
            // Real-time validation
            usernameInput.addEventListener('input', function() {
                validateUsername();
                clearFieldError(usernameInput);
            });
            
            emailInput.addEventListener('input', function() {
                validateEmail();
                clearFieldError(emailInput);
            });
            
            passwordInput.addEventListener('input', function() {
                validatePassword();
                updatePasswordStrength();
                clearFieldError(passwordInput);
            });
            
            confirmPasswordInput.addEventListener('input', function() {
                validateConfirmPassword();
                clearFieldError(confirmPasswordInput);
            });
            
            termsCheckbox.addEventListener('change', function() {
                clearFieldError(termsCheckbox);
            });
            
            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateForm()) {
                    submitForm();
                }
            });
        });
        
        function validateUsername() {
            const username = document.getElementById('username').value;
            const requirements = document.querySelectorAll('#username-length, #username-format');
            
            // Length validation
            const lengthMet = username.length >= 3 && username.length <= 30;
            requirements[0].className = `requirement ${lengthMet ? 'met' : 'unmet'}`;
            requirements[0].querySelector('i').className = lengthMet ? 'fas fa-check' : 'fas fa-circle';
            
            // Format validation
            const formatMet = /^[a-zA-Z0-9_-]+$/.test(username);
            requirements[1].className = `requirement ${formatMet ? 'met' : 'unmet'}`;
            requirements[1].querySelector('i').className = formatMet ? 'fas fa-check' : 'fas fa-circle';
            
            return lengthMet && formatMet;
        }
        
        function validateEmail() {
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function validatePassword() {
            const password = document.getElementById('password').value;
            const requirements = document.querySelectorAll('#password-length, #password-uppercase, #password-lowercase, #password-number, #password-special');
            
            // Length validation
            const lengthMet = password.length >= 8;
            requirements[0].className = `requirement ${lengthMet ? 'met' : 'unmet'}`;
            requirements[0].querySelector('i').className = lengthMet ? 'fas fa-check' : 'fas fa-circle';
            
            // Uppercase validation
            const uppercaseMet = /[A-Z]/.test(password);
            requirements[1].className = `requirement ${uppercaseMet ? 'met' : 'unmet'}`;
            requirements[1].querySelector('i').className = uppercaseMet ? 'fas fa-check' : 'fas fa-circle';
            
            // Lowercase validation
            const lowercaseMet = /[a-z]/.test(password);
            requirements[2].className = `requirement ${lowercaseMet ? 'met' : 'unmet'}`;
            requirements[2].querySelector('i').className = lowercaseMet ? 'fas fa-check' : 'fas fa-circle';
            
            // Number validation
            const numberMet = /\d/.test(password);
            requirements[3].className = `requirement ${numberMet ? 'met' : 'unmet'}`;
            requirements[3].querySelector('i').className = numberMet ? 'fas fa-check' : 'fas fa-circle';
            
            // Special character validation
            const specialMet = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            requirements[4].className = `requirement ${specialMet ? 'met' : 'unmet'}`;
            requirements[4].querySelector('i').className = specialMet ? 'fas fa-check' : 'fas fa-circle';
            
            return lengthMet && uppercaseMet && lowercaseMet && numberMet && specialMet;
        }
        
        function updatePasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthDiv = document.getElementById('password-strength');
            const strengthText = document.getElementById('strength-text');
            const strengthPercentage = document.getElementById('strength-percentage');
            const strengthFill = document.getElementById('strength-fill');
            
            if (password.length === 0) {
                strengthDiv.style.display = 'none';
                return;
            }
            
            strengthDiv.style.display = 'block';
            
            let score = 0;
            if (password.length >= 8) score += 20;
            if (/[A-Z]/.test(password)) score += 20;
            if (/[a-z]/.test(password)) score += 20;
            if (/\d/.test(password)) score += 20;
            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) score += 20;
            
            if (score <= 40) {
                strengthText.textContent = 'Weak';
                strengthFill.className = 'strength-fill weak';
                strengthPercentage.textContent = score + '%';
            } else if (score <= 80) {
                strengthText.textContent = 'Medium';
                strengthFill.className = 'strength-fill medium';
                strengthPercentage.textContent = score + '%';
            } else {
                strengthText.textContent = 'Strong';
                strengthFill.className = 'strength-fill strong';
                strengthPercentage.textContent = score + '%';
            }
        }
        
        function validateConfirmPassword() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            return password === confirmPassword;
        }
        
        function validateForm() {
            let isValid = true;
            
            // Validate username
            if (!validateUsername()) {
                showFieldError(document.getElementById('username'), 'Please enter a valid username (3-30 characters, letters, numbers, hyphens, underscores only).');
                isValid = false;
            }
            
            // Validate email
            if (!validateEmail()) {
                showFieldError(document.getElementById('email'), 'Please enter a valid email address.');
                isValid = false;
            }
            
            // Validate password
            if (!validatePassword()) {
                showFieldError(document.getElementById('password'), 'Please ensure your password meets all requirements.');
                isValid = false;
            }
            
            // Validate confirm password
            if (!validateConfirmPassword()) {
                showFieldError(document.getElementById('confirm-password'), 'Passwords do not match.');
                isValid = false;
            }
            
            // Validate terms acceptance
            if (!document.getElementById('terms-accept').checked) {
                showFieldError(document.getElementById('terms-accept'), 'You must accept the terms and conditions to continue.');
                isValid = false;
            }
            
            return isValid;
        }
        
        function showFieldError(input, message) {
            input.classList.add('is-invalid');
            const errorDiv = input.parentNode.querySelector('.invalid-feedback');
            if (errorDiv) {
                errorDiv.textContent = message;
            }
        }
        
        function clearFieldError(input) {
            input.classList.remove('is-invalid');
            input.classList.remove('is-valid');
        }
        
        function submitForm() {
            const registerBtn = document.getElementById('register-btn');
            const form = document.getElementById('registerForm');
            
            // Disable button and show loading
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<span class="loading-spinner spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Creating Account...';
            
            // Submit the form
            form.submit();
        }
        
        function togglePassword(fieldId) {
            const passwordInput = document.getElementById(fieldId);
            const passwordIcon = document.getElementById(fieldId === 'password' ? 'password-icon' : 'confirm-password-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordIcon.classList.remove('fa-eye');
                passwordIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                passwordIcon.classList.remove('fa-eye-slash');
                passwordIcon.classList.add('fa-eye');
            }
        }
        
        function showTerms() {
            const modal = new bootstrap.Modal(document.getElementById('termsModal'));
            modal.show();
        }
        
        function showPrivacy() {
            const modal = new bootstrap.Modal(document.getElementById('privacyModal'));
            modal.show();
        }
        
        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
</body>
</html>
